<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>ZPROVEART</title>
<link rel="stylesheet" href="{{ url_for('static', path='css/zproveart.css') }}">
</head>

<body>

<h1>ZPROVEART</h1>

<form class="filters block" method="get" action="/zproveart">
    <div class="fam-list">
    {% for f in families %}
        <label class="fam-item">
            <input type="checkbox" name="family" value="{{ f.COD_FAM_0 }}"
                {% if f.COD_FAM_0 in family_list %}checked{% endif %}>
            <span class="fam-text">{{ f.COD_FAM_0 }} - {{ f.DES_FAM_0 }}</span>
        </label>
    {% endfor %}
    </div>
    <div class="date-filter">
        <label class="muted">Desde</label>
        <input type="date" name="from" value="{{ date_from }}">

        <label class="muted">Hasta</label>
        <input type="date" name="to" value="{{ date_to }}">
    </div>

    <input type="hidden" name="page" value="1">

    <button type="submit">Aplicar Filtros</button>

</form>

<div class="grid">
{% for p in products %}
<div class="card">

    <!-- CABECERA (Articulo + Proveedor + Familia) -->
    <div class="block card-head">
        <div class="header header-row">
            <div class="head-item h1">
                ARTÍCULO: {{ p.ITMREF_0 }} - {{ p.ITMDES_0 }}
            </div>
            <div class="head-item h2">
                Proveedor: {{ p.BPSNUM_0 }} - {{ p.BPSNAM_0 }}
            </div>
            <div class="head-item h2">
                Familia: {{ p.COD_FAM_0 }} - {{ p.DES_FAM_0 }}
            </div>
        </div>
    </div>

    <!-- CUERPO (Foto | ZV | Tabla) -->
    <div class="block card-body">
        <div class="body-row">

            <!-- Foto -->
            <div class="thumb">
                {% if p.URL_0 %}
                <img src="{{ p.URL_0 }}" alt="Imagen producto">
                {% else %}
                <span class="muted">Sin imagen</span>
                {% endif %}
            </div>

            <!-- ZV -->
            <div class="block body-zv">
                <div class="kv-grid">
                    <div class="kv"><div class="k">F. últ. compra</div><div class="v">{{ p.FUC_0_FMT }}</div></div>
                    <div class="kv"><div class="k">UQTY</div><div class="v">{{ p.UQTY_0 }}</div></div>
                    <div class="kv"><div class="k">FOB</div><div class="v">{{ p.FOB_0_FMT }}</div></div>

                    <div class="kv"><div class="k">P. Unidad</div><div class="v">{{ p.PUE_0_FMT }}</div></div>
                    <div class="kv"><div class="k">PVP</div><div class="v">{{ p.PVPT4_0_FMT }}</div></div>
                    <div class="kv"><div class="k">DTO</div><div class="v">{{ p.DTO_0_FMT }}</div></div>

                    <div class="kv"><div class="k">DIF</div><div class="v">{{ p.DIF_0_FMT }}</div></div>
                    <div class="kv"><div class="k">Arancel</div><div class="v">{{ p.ARANCEL_0_FMT }}</div></div>
                </div>
            </div>

            <!-- Tabla -->
            <div class="block body-table">
                <div class="m12-title">Ventas / Compras últimos 12 meses</div>
                <table class="m12">
                    <tr>
                        <th>Mes</th>
                        <th>Ventas</th>
                        <th>Compras</th>
                    </tr>
                    {% for r in p.m12 %}
                    <tr>
                        <td>{{ r.label }}</td>
                        <td>{{ r.ventas }}</td>
                        <td>{{ r.compras }}</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>

        </div>
    </div>

    <!-- PIE (Checkbox + comentario + botón) -->
    <div class="block card-foot">
        <form class="actions js-send" method="post" action="/zproveart/submit">
            <input type="hidden" name="itmref" value="{{ p.ITMREF_0 }}">
            <label><input type="checkbox" name="selected" value="1"> Sel</label>
            <input type="text" name="comment" placeholder="Comentario...">
            <button type="submit">Enviar</button>
        </form>
    </div>

</div>
{% endfor %}
</div>

<div class="pager">

    {% set fam_qs = "" %}
    {% for fc in family_list %}
        {% set fam_qs = fam_qs + "&family=" + fc %}
    {% endfor %}
    {% set date_qs = "" %}
    {% if date_from %}
        {% set date_qs = date_qs + "&from=" + date_from %}
    {% endif %}
    {% if date_to %}
        {% set date_qs = date_qs + "&to=" + date_to %}
    {% endif %}

    <a class="{% if page <= 1 %}disabled{% endif %}"
       href="/zproveart?page={{ page - 1 }}&page_size={{ page_size }}{{ fam_qs }}{{ date_qs }}">⬅ Prev</a>

    <span class="muted">Página {{ page }} / {{ total_pages }}</span>

    <a class="{% if page >= total_pages %}disabled{% endif %}"
       href="/zproveart?page={{ page + 1 }}&page_size={{ page_size }}{{ fam_qs }}{{ date_qs }}">Next ➡</a>
</div>
<script src="{{ url_for('static', path='js/zproveart.js') }}"></script>
</body>
</html>
